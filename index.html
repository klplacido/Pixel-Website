<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pixel Webmail</title>

  <!-- Bootstrap (for modal only) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Favicon (animated GIF) -->
  <link rel="icon" type="image/gif" href="https://giffiles.alphacoders.com/426/4268.gif">

  <!-- CSS -->
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/login.css">
  <link rel="stylesheet" href="css/inbox.css">
  <link rel="stylesheet" href="css/envelope.css">
  <link rel="stylesheet" href="css/letter.css">
</head>
<body>

  <!-- Screen 1: Login -->
  <section class="stage view active" id="view-login">
    <div class="panel panel--login">
      <div class="panel-topbar">
        <span class="icon">♥</span><span>SIGN IN</span>
      </div>

      <div class="login-wrap">
        <div class="login-inner">
          <div>
            <div class="login-brand">
              <div class="pixel-title">WEBMAIL</div>
              <div class="mail-heart">✉</div>
            </div>

            <div class="mb-2">
              <div class="form-label">Username</div>
              <input id="login-username" class="pixel-input" type="text" placeholder="Enter username" autocomplete="off">
            </div>

            <div class="mb-2">
              <div class="form-label">Password</div>
              <input id="login-password" class="pixel-input" type="password" placeholder="Enter password" autocomplete="off">
            </div>

            <div class="d-flex gap-2 align-items-center mt-3">
              <button class="btn btn-pixel" id="btn-login">Login</button>
            </div>

            <div class="login-error" id="login-error">Invalid username or password.</div>
          </div>

          <!-- ✅ FIXED: properly closed cat-box -->
          <div class="cat-box">
            <img
              src="https://giffiles.alphacoders.com/426/4268.gif"
              alt="pixel cat"
              class="cat-gif"
            >
          </div>
        </div>
      </div>
    </div>
  </section>


  <!-- Screen 2: Inbox -->
  <section class="stage view" id="view-inbox">
    <div class="panel">
      <div class="panel-topbar">
        <span class="icon">✉</span><span>EMAILS</span>

        <span id="user-badge" class="ms-2" style="font-size:12px;font-weight:900;opacity:.9;"></span>

        <div class="ms-auto inbox-actions">
          <button id="btn-new" class="btn btn-outline-pixel" data-bs-toggle="modal" data-bs-target="#composeModal">New</button>
          <button class="btn btn-outline-pixel" id="btn-logout">Logout</button>
        </div>
      </div>

      <div class="inbox-body">
        <div class="scroll-area" id="mail-list"></div>
      </div>
    </div>
  </section>


  <!-- Screen 3: Envelope -->
  <section class="stage view" id="view-envelope">
    <div class="panel panel--transparent">
      <div class="envelope-stage">
        <div class="envelope" id="envelope">
          <div class="env-base"></div>
          <div class="env-flap"></div>
          <div class="env-bottom"></div>
          <div class="env-heart"></div>
        </div>
      </div>

      <div class="d-flex justify-content-center gap-2" style="margin-top:-10px;">
        <button class="btn btn-outline-pixel" id="btn-back-inbox">Back</button>
      </div>
    </div>
  </section>


  <!-- Screen 4: Letter -->
  <section class="stage view" id="view-letter">
    <div class="panel panel--transparent">
      <div class="top-controls">
        <button class="btn btn-outline-pixel" id="btn-letter-back">Back</button>
      </div>

      <div class="letter-wrap">
        <div class="letter-paper">
          <p class="letter-text" id="letter-content"></p>
        </div>
      </div>
    </div>
  </section>


  <!-- Compose Modal -->
  <div class="modal fade" id="composeModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title">New Letter</div>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <label class="form-label modal-label">Subject</label>
          <input id="compose-subject" class="modal-input form-control" placeholder="e.g., Trial Letter">

          <label class="form-label modal-label mt-3">Message</label>
          <textarea id="compose-body" class="modal-input form-control" rows="6" placeholder="Write your letter..."></textarea>
        </div>

        <div class="modal-footer">
          <button class="btn btn-outline-pixel" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-pixel" id="btn-send">Send</button>
        </div>
      </div>
    </div>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // Firebase config (provided by user)
    const firebaseConfig = {
      apiKey: "AIzaSyA2FQ-sc0H3BDUeSWrX8F0H_PExFGF6yIM",
      authDomain: "pixel-web-3acac.firebaseapp.com",
      projectId: "pixel-web-3acac",
      storageBucket: "pixel-web-3acac.firebasestorage.app",
      messagingSenderId: "581880612127",
      appId: "1:581880612127:web:a53b13cace6609585f9c2a",
      measurementId: "G-NC5GZ1CXP0"
    };

    try {
      if (typeof firebase !== 'undefined' && firebase?.initializeApp) {
        firebase.initializeApp(firebaseConfig);
        window.__DB = firebase.firestore();
      } else {
        window.__DB = null;
      }
    } catch (err) {
      console.error('Firebase init failed', err);
      window.__DB = null;
    }
  </script>

  <!-- JS -->
  <script src="js/app.js"></script>
  <script src="js/login.js"></script>
  <script src="js/inbox.js"></script>
  <script src="js/envelope.js"></script>
  <script src="js/letter.js"></script>

  <script>
  window.addEventListener("error", (e) => {
    const box = document.getElementById("login-error");
    if (box) {
      box.style.display = "block";
      box.textContent = "JS ERROR: " + (e.message || "Unknown error");
    }
  });
</script>
</body>
</html>